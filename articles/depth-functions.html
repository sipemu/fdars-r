<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Functional Depth Functions • fdars</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Functional Depth Functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fdars</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to fdars</a></li>
    <li><a class="dropdown-item" href="../articles/custom-plotting.html">Custom Plotting with ggplot2</a></li>
    <li><a class="dropdown-item" href="../articles/intro-to-smoothing.html">Introduction to Smoothing</a></li>
    <li><a class="dropdown-item" href="../articles/working-with-derivatives.html">Working with Derivatives</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Methods</h6></li>
    <li><a class="dropdown-item" href="../articles/fpca.html">Functional PCA (FPCA)</a></li>
    <li><a class="dropdown-item" href="../articles/basis-representation.html">Basis Representation</a></li>
    <li><a class="dropdown-item" href="../articles/depth-functions.html">Depth Functions</a></li>
    <li><a class="dropdown-item" href="../articles/distance-metrics.html">Distance Metrics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/clustering.html">Clustering</a></li>
    <li><a class="dropdown-item" href="../articles/outlier-detection.html">Outlier Detection</a></li>
    <li><a class="dropdown-item" href="../articles/regression.html">Regression</a></li>
    <li><a class="dropdown-item" href="../articles/seasonal-analysis.html">Seasonal Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/covariance-functions.html">Covariance Functions</a></li>
    <li><a class="dropdown-item" href="../articles/simulation-toolbox.html">Simulation Toolbox</a></li>
    <li><a class="dropdown-item" href="../articles/irregular-sampling.html">Irregular Sampling</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sipemu/fdars-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Functional Depth Functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sipemu/fdars-r/blob/main/vignettes/depth-functions.Rmd" class="external-link"><code>vignettes/depth-functions.Rmd</code></a></small>
      <div class="d-none name"><code>depth-functions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Functional depth is a measure of how “central” or “typical” a curve
is within a sample of curves. Curves with high depth are considered
representative of the sample, while curves with low depth are outliers
or extreme observations.</p>
<p>Depth functions extend the concept of statistical depth (like data
depth for multivariate data) to the infinite-dimensional setting of
functional data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sipemu.github.io/fdars-r/">fdars</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'fdars'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     cov, decompose, deriv, median, sd, var</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     norm</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create example data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">t_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Main sample: sine curves with noise</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span>, <span class="va">m</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">X</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t_grid</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span>, sd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Add some outliers</span></span>
<span><span class="va">X</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t_grid</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>  <span class="co"># Magnitude outlier</span></span>
<span><span class="va">X</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t_grid</span><span class="op">)</span>       <span class="co"># Shape outlier</span></span>
<span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="va">X</span>, argvals <span class="op">=</span> <span class="va">t_grid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span></span></code></pre></div>
<p><img src="depth-functions_files/figure-html/setup-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level2">
<h2 id="available-depth-functions">Available Depth Functions<a class="anchor" aria-label="anchor" href="#available-depth-functions"></a>
</h2>
<p>All depth functions are accessed through the unified
<code><a href="../reference/depth.html">depth()</a></code> function with a <code>method</code> parameter.</p>
<div class="section level3">
<h3 id="fraiman-muniz-depth-method-fm">Fraiman-Muniz Depth (method = “FM”)<a class="anchor" aria-label="anchor" href="#fraiman-muniz-depth-method-fm"></a>
</h3>
<p>The Fraiman-Muniz depth integrates univariate depths across the
domain. For each time point, it computes the proportion of curves above
and below the given curve, then averages across time.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depths_fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"FM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show depths (outliers should have lower depth)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  curve <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">depths_fm</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  note <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"magnitude outlier"</span>, <span class="st">"shape outlier"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"normal"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   curve  depth              note</span></span>
<span><span class="co">#&gt; 1     1 0.0000 magnitude outlier</span></span>
<span><span class="co">#&gt; 2     2 0.1113     shape outlier</span></span>
<span><span class="co">#&gt; 3     3 0.5233            normal</span></span>
<span><span class="co">#&gt; 4     4 0.5707            normal</span></span>
<span><span class="co">#&gt; 5     5 0.5407            normal</span></span></code></pre></div>
<p><strong>Intuition</strong>: At each time point, FM depth asks: “What
proportion of curves lie above and below this curve?” A curve that is
consistently in the middle of the data cloud at every time point will
have high FM depth.</p>
<p>The FM depth can be scaled to [0, 1] using the <code>scale</code>
parameter:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depths_fm_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"FM"</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">depths_fm_scaled</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0000000 0.5813333</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="modal-depth-method-mode">Modal Depth (method = “mode”)<a class="anchor" aria-label="anchor" href="#modal-depth-method-mode"></a>
</h3>
<p>Modal depth uses kernel density estimation in function space. Curves
in high-density regions have high depth.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depths_mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"mode"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">depths_mode</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.03335153 0.09401245 0.83156568 0.84229565 0.83229521 0.82640249</span></span></code></pre></div>
<p><strong>Intuition</strong>: Modal depth estimates local density in
function space. Curves in “crowded” regions (where many similar curves
exist) have high depth. Think of it like finding the mode of a
distribution, but for curves.</p>
</div>
<div class="section level3">
<h3 id="random-projection-depth-method-rp">Random Projection Depth (method = “RP”)<a class="anchor" aria-label="anchor" href="#random-projection-depth-method-rp"></a>
</h3>
<p>Projects curves onto random directions and computes univariate depths
of the projections. More robust to local variations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depths_rp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"RP"</span>, nproj <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">depths_rp</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.04000000 0.07870968 0.26258065 0.29483871 0.27806452 0.26193548</span></span></code></pre></div>
<p><strong>Intuition</strong>: RP depth projects all curves onto random
1D directions and computes depth there. It’s robust because outliers
can’t hide from all projection angles - if a curve is unusual, some
projection will reveal it.</p>
</div>
<div class="section level3">
<h3 id="random-tukey-depth-method-rt">Random Tukey Depth (method = “RT”)<a class="anchor" aria-label="anchor" href="#random-tukey-depth-method-rt"></a>
</h3>
<p>Takes the minimum depth across random projections, similar to Tukey’s
halfspace depth. Very robust to outliers.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depths_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"RT"</span>, nproj <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">depths_rt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.03225806 0.03225806 0.03225806 0.06451613 0.03225806 0.03225806</span></span></code></pre></div>
<p><strong>Intuition</strong>: RT depth takes the <em>minimum</em> depth
across all projections. This is very conservative - a curve is only
considered central if it looks central from <em>every</em> angle. This
makes RT extremely robust to outliers.</p>
</div>
<div class="section level3">
<h3 id="functional-spatial-depth-method-fsd">Functional Spatial Depth (method = “FSD”)<a class="anchor" aria-label="anchor" href="#functional-spatial-depth-method-fsd"></a>
</h3>
<p>Based on unit vectors pointing from each curve to all others.
Measures centrality in a geometric sense.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depths_fsd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"FSD"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">depths_fsd</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.03927198 0.06164440 0.34346531 0.39240477 0.33894657 0.32391302</span></span></code></pre></div>
<p><strong>Intuition</strong>: FSD computes unit vectors from each curve
to all others. A central curve has these vectors pointing in all
directions (they cancel out), resulting in high depth. An outlier has
most vectors pointing in one direction (away from the data cloud).</p>
</div>
<div class="section level3">
<h3 id="kernel-functional-spatial-depth-method-kfsd">Kernel Functional Spatial Depth (method = “KFSD”)<a class="anchor" aria-label="anchor" href="#kernel-functional-spatial-depth-method-kfsd"></a>
</h3>
<p>Smoothed version of FSD using a Gaussian kernel. The bandwidth
<code>h</code> controls the smoothing.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depths_kfsd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"KFSD"</span>, h <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">depths_kfsd</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2646598 0.2646598 0.3086986 0.3194105 0.3089607 0.3032314</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random-projection-depth-with-derivatives-method-rpd">Random Projection Depth with Derivatives (method = “RPD”)<a class="anchor" aria-label="anchor" href="#random-projection-depth-with-derivatives-method-rpd"></a>
</h3>
<p>Incorporates derivative information, making it sensitive to shape
changes in addition to magnitude.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">depths_rpd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"RPD"</span>, nproj <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">depths_rpd</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1106667 0.1053333 0.2013333 0.2313333 0.2033333 0.1846667</span></span></code></pre></div>
<p><strong>Intuition</strong>: RPD is like RP, but the projections are
based on curve derivatives. This makes it sensitive to <em>shape</em>
differences - curves with unusual wiggliness or local behavior will have
low depth even if their overall level is typical.</p>
</div>
</div>
<div class="section level2">
<h2 id="comparing-depth-functions">Comparing Depth Functions<a class="anchor" aria-label="anchor" href="#comparing-depth-functions"></a>
</h2>
<p>Different depth functions have different properties and may rank
curves differently:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute all depths using unified depth() function</span></span>
<span><span class="va">all_depths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  FM <span class="op">=</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"FM"</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"mode"</span><span class="op">)</span>,</span>
<span>  RP <span class="op">=</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"RP"</span>, nproj <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  RT <span class="op">=</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"RT"</span>, nproj <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>  FSD <span class="op">=</span> <span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"FSD"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Correlation between depth functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">all_depths</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;        FM mode   RP   RT  FSD</span></span>
<span><span class="co">#&gt; FM   1.00 0.98 0.92 0.19 0.98</span></span>
<span><span class="co">#&gt; mode 0.98 1.00 0.93 0.18 0.97</span></span>
<span><span class="co">#&gt; RP   0.92 0.93 1.00 0.11 0.96</span></span>
<span><span class="co">#&gt; RT   0.19 0.18 0.11 1.00 0.14</span></span>
<span><span class="co">#&gt; FSD  0.98 0.97 0.96 0.14 1.00</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Which curves are identified as outliers (lowest depth)?</span></span>
<span><span class="va">outlier_ranks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">all_depths</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">outlier_ranks</span></span>
<span><span class="co">#&gt;      FM mode RP RT FSD</span></span>
<span><span class="co">#&gt; [1,]  1    1  1  1   1</span></span>
<span><span class="co">#&gt; [2,]  2    2  2  2   2</span></span>
<span><span class="co">#&gt; [3,] 10   10 23  3  10</span></span></code></pre></div>
<p>All depth functions correctly identify curves 1 and 2 as having low
depth.</p>
<div class="section level3">
<h3 id="visualizing-depth">Visualizing Depth<a class="anchor" aria-label="anchor" href="#visualizing-depth"></a>
</h3>
<p>A powerful way to understand depth is to color curves by their depth
values:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize curves colored by their FM depth</span></span>
<span><span class="va">df_depth_viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">t_grid</span>, <span class="va">n</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  curve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, each <span class="op">=</span> <span class="va">m</span><span class="op">)</span>,</span>
<span>  depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">depths_fm</span>, each <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_depth_viz</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">curve</span>, color <span class="op">=</span> <span class="va">depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, name <span class="op">=</span> <span class="st">"FM Depth"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Curves Colored by Depth"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Dark = low depth (outlier), Bright = high depth (central)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"t"</span>, y <span class="op">=</span> <span class="st">"X(t)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="depth-functions_files/figure-html/depth-visualization-1.png" class="r-plt" alt="" width="100%"></p>
<p>This visualization immediately reveals which curves are outliers
(dark colors) and which are central (bright colors). The magnitude
outlier (shifted up) and shape outlier (cosine instead of sine) both
appear with low depth values.</p>
</div>
</div>
<div class="section level2">
<h2 id="depth-based-statistics">Depth-Based Statistics<a class="anchor" aria-label="anchor" href="#depth-based-statistics"></a>
</h2>
<div class="section level3">
<h3 id="functional-median">Functional Median<a class="anchor" aria-label="anchor" href="#functional-median"></a>
</h3>
<p>The median is the curve with maximum depth:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using different depth functions via method parameter</span></span>
<span><span class="va">med_fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/median.html">median</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"FM"</span><span class="op">)</span></span>
<span><span class="va">med_mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/median.html">median</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"mode"</span><span class="op">)</span></span>
<span><span class="va">med_rp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/median.html">median</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"RP"</span>, nproj <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The median is one of the original curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"FM"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 13</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="trimmed-mean">Trimmed Mean<a class="anchor" aria-label="anchor" href="#trimmed-mean"></a>
</h3>
<p>Remove a proportion of curves with lowest depth, then compute the
mean:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 10% trimmed mean using different depth methods</span></span>
<span><span class="va">trim_fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trimmed.html">trimmed</a></span><span class="op">(</span><span class="va">fd</span>, trim <span class="op">=</span> <span class="fl">0.1</span>, method <span class="op">=</span> <span class="st">"FM"</span><span class="op">)</span></span>
<span><span class="va">trim_mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trimmed.html">trimmed</a></span><span class="op">(</span><span class="va">fd</span>, trim <span class="op">=</span> <span class="fl">0.1</span>, method <span class="op">=</span> <span class="st">"mode"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare trimmed mean to regular mean</span></span>
<span><span class="va">mean_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize: trimmed mean is more robust to outliers</span></span>
<span><span class="va">df_compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">t_grid</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mean_curve</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, <span class="va">trim_fm</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mean"</span>, <span class="st">"Trimmed Mean (FM)"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_compare</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mean vs Trimmed Mean"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"t"</span>, y <span class="op">=</span> <span class="st">"X(t)"</span>, color <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="depth-functions_files/figure-html/plot-robust-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="functional-variance-and-trimmed-variance">Functional Variance and Trimmed Variance<a class="anchor" aria-label="anchor" href="#functional-variance-and-trimmed-variance"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Regular variance</span></span>
<span><span class="va">var_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/var.html">var</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Trimmed variance (more robust)</span></span>
<span><span class="va">trimvar_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trimvar.html">trimvar</a></span><span class="op">(</span><span class="va">fd</span>, trim <span class="op">=</span> <span class="fl">0.1</span>, method <span class="op">=</span> <span class="st">"FM"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="choosing-a-depth-function">Choosing a Depth Function<a class="anchor" aria-label="anchor" href="#choosing-a-depth-function"></a>
</h2>
<table class="table">
<thead><tr class="header">
<th>Depth</th>
<th>Strengths</th>
<th>Best For</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>FM</td>
<td>Simple, interpretable</td>
<td>General use</td>
</tr>
<tr class="even">
<td>mode</td>
<td>Sensitive to local density</td>
<td>Multimodal data</td>
</tr>
<tr class="odd">
<td>RP</td>
<td>Robust, fast</td>
<td>Large datasets</td>
</tr>
<tr class="even">
<td>RT</td>
<td>Very robust</td>
<td>Heavy outlier contamination</td>
</tr>
<tr class="odd">
<td>FSD</td>
<td>Geometric interpretation</td>
<td>Spatial patterns</td>
</tr>
<tr class="even">
<td>KFSD</td>
<td>Smooth, tunable</td>
<td>When smoothness matters</td>
</tr>
<tr class="odd">
<td>RPD</td>
<td>Shape-sensitive</td>
<td>When derivatives matter</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a>
</h2>
<p>All depth computations use a parallel Rust backend:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Large dataset benchmark</span></span>
<span><span class="va">X_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">500</span> <span class="op">*</span> <span class="fl">200</span><span class="op">)</span>, <span class="fl">500</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">fd_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="va">X_large</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd_large</span>, method <span class="op">=</span> <span class="st">"FM"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed</span></span>
<span><span class="co">#&gt;   0.032   0.000   0.032</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/depth.html">depth</a></span><span class="op">(</span><span class="va">fd_large</span>, method <span class="op">=</span> <span class="st">"RP"</span>, nproj <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed</span></span>
<span><span class="co">#&gt;   0.089   0.000   0.089</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Fraiman, R. and Muniz, G. (2001). Trimmed means for functional data.
<em>Test</em>, 10(2), 419-440.</li>
<li>Cuevas, A., Febrero, M., and Fraiman, R. (2007). Robust estimation
and classification for functional data via projection-based depth
notions. <em>Computational Statistics</em>, 22(3), 481-496.</li>
<li>López-Pintado, S. and Romo, J. (2009). On the concept of depth for
functional data. <em>Journal of the American Statistical
Association</em>, 104(486), 718-734.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Müller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
