<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Seasonal Analysis of Functional Data • fdars</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Seasonal Analysis of Functional Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fdars</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to fdars</a></li>
    <li><a class="dropdown-item" href="../articles/custom-plotting.html">Custom Plotting with ggplot2</a></li>
    <li><a class="dropdown-item" href="../articles/intro-to-smoothing.html">Introduction to Smoothing</a></li>
    <li><a class="dropdown-item" href="../articles/working-with-derivatives.html">Working with Derivatives</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Methods</h6></li>
    <li><a class="dropdown-item" href="../articles/fpca.html">Functional PCA (FPCA)</a></li>
    <li><a class="dropdown-item" href="../articles/basis-representation.html">Basis Representation</a></li>
    <li><a class="dropdown-item" href="../articles/depth-functions.html">Depth Functions</a></li>
    <li><a class="dropdown-item" href="../articles/distance-metrics.html">Distance Metrics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Analysis</h6></li>
    <li><a class="dropdown-item" href="../articles/clustering.html">Clustering</a></li>
    <li><a class="dropdown-item" href="../articles/outlier-detection.html">Outlier Detection</a></li>
    <li><a class="dropdown-item" href="../articles/regression.html">Regression</a></li>
    <li><a class="dropdown-item" href="../articles/seasonal-analysis.html">Seasonal Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/covariance-functions.html">Covariance Functions</a></li>
    <li><a class="dropdown-item" href="../articles/simulation-toolbox.html">Simulation Toolbox</a></li>
    <li><a class="dropdown-item" href="../articles/irregular-sampling.html">Irregular Sampling</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sipemu/fdars-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Seasonal Analysis of Functional Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sipemu/fdars-r/blob/main/vignettes/seasonal-analysis.Rmd" class="external-link"><code>vignettes/seasonal-analysis.Rmd</code></a></small>
      <div class="d-none name"><code>seasonal-analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Seasonal patterns are ubiquitous in functional data: temperature
cycles, biological rhythms, economic fluctuations, and many more. This
vignette demonstrates the seasonal analysis capabilities of fdars,
organized from basic period estimation to advanced techniques for
complex signals.</p>
<p><strong>What you’ll learn:</strong></p>
<ul>
<li>How to estimate the period of seasonal signals</li>
<li>How to detect multiple concurrent seasonalities</li>
<li>How to tune peak detection parameters for noisy data</li>
<li>When to use instantaneous period estimation (and when not to)</li>
<li>How to analyze short series with only 3-5 cycles</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sipemu.github.io/fdars-r/">fdars</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'fdars'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     cov, decompose, deriv, median, sd, var</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     norm</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimating-seasonal-period">Estimating Seasonal Period<a class="anchor" aria-label="anchor" href="#estimating-seasonal-period"></a>
</h2>
<p>The first step in seasonal analysis is often determining the period.
fdars provides two methods: FFT (frequency domain) and ACF
(autocorrelation).</p>
<div class="section level3">
<h3 id="simple-periodic-signals">Simple Periodic Signals<a class="anchor" aria-label="anchor" href="#simple-periodic-signals"></a>
</h3>
<p>Let’s start with a clean sinusoidal signal.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Time grid: 10 complete cycles of period 2</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">period_true</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Pure sine wave</span></span>
<span><span class="va">X_pure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span></span>
<span><span class="va">fd_pure</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_pure</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X_pure</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Pure Seasonal Signal (Period = 2)"</span>, x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/simple-signal-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># FFT method</span></span>
<span><span class="va">est_fft</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_pure</span>, method <span class="op">=</span> <span class="st">"fft"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"FFT estimate:"</span>, <span class="va">est_fft</span><span class="op">$</span><span class="va">period</span>, <span class="st">"(true:"</span>, <span class="va">period_true</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; FFT estimate: 2.005013 (true: 2 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Confidence:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">est_fft</span><span class="op">$</span><span class="va">confidence</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Confidence: 199.585</span></span></code></pre></div>
<p>The <strong>confidence</strong> value indicates how pronounced the
dominant frequency is relative to other frequencies. High confidence
(close to 1) means a clear, dominant period.</p>
</div>
<div class="section level3">
<h3 id="noisy-signals">Noisy Signals<a class="anchor" aria-label="anchor" href="#noisy-signals"></a>
</h3>
<p>Real data always contains noise. Let’s see how the methods handle
it.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add noise</span></span>
<span><span class="va">X_noisy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">fd_noisy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_noisy</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X_noisy</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Noisy Seasonal Signal (SD = 0.3)"</span>, x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/noisy-signal-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare methods</span></span>
<span><span class="va">est_fft_noisy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_noisy</span>, method <span class="op">=</span> <span class="st">"fft"</span><span class="op">)</span></span>
<span><span class="va">est_acf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_noisy</span>, method <span class="op">=</span> <span class="st">"acf"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"True period:"</span>, <span class="va">period_true</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; True period: 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"FFT estimate:"</span>, <span class="va">est_fft_noisy</span><span class="op">$</span><span class="va">period</span>, <span class="st">"(confidence:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">est_fft_noisy</span><span class="op">$</span><span class="va">confidence</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; FFT estimate: 2.005013 (confidence: 171.93 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"ACF estimate:"</span>, <span class="va">est_acf</span><span class="op">$</span><span class="va">period</span>, <span class="st">"(confidence:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">est_acf</span><span class="op">$</span><span class="va">confidence</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ACF estimate: 2.005013 (confidence: 0.783 )</span></span></code></pre></div>
<p>Both methods typically agree for clean periodic signals. The ACF
method can be more robust to certain types of noise, while FFT is faster
and handles multiple harmonics well.</p>
</div>
<div class="section level3">
<h3 id="signals-with-multiple-harmonics">Signals with Multiple Harmonics<a class="anchor" aria-label="anchor" href="#signals-with-multiple-harmonics"></a>
</h3>
<p>Real seasonal patterns often have harmonics (e.g., yearly +
half-yearly components that share the same fundamental period).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Signal with 2nd and 3rd harmonics</span></span>
<span><span class="va">X_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span> <span class="op">+</span></span>
<span>           <span class="fl">0.3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># 2nd harmonic</span></span>
<span>           <span class="fl">0.1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">6</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># 3rd harmonic</span></span>
<span>           <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">fd_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_multi</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X_multi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Signal with Multiple Harmonics"</span>, x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/multi-harmonic-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_multi</span>, method <span class="op">=</span> <span class="st">"fft"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Estimated period:"</span>, <span class="va">est_multi</span><span class="op">$</span><span class="va">period</span>, <span class="st">"(true:"</span>, <span class="va">period_true</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated period: 2.005013 (true: 2 )</span></span></code></pre></div>
<p>The FFT method correctly identifies the <strong>fundamental
period</strong>, even when harmonics are present. The harmonics share
the same fundamental frequency, so they reinforce the estimate.</p>
</div>
</div>
<div class="section level2">
<h2 id="detecting-multiple-concurrent-seasonalities">Detecting Multiple Concurrent Seasonalities<a class="anchor" aria-label="anchor" href="#detecting-multiple-concurrent-seasonalities"></a>
</h2>
<p>Sometimes a signal contains <strong>multiple independent
periodicities</strong> (e.g., daily and yearly cycles). The
<code><a href="../reference/estimate.period.html">estimate.period()</a></code> function returns only the dominant
period. Here’s how to detect multiple periods.</p>
<div class="section level3">
<h3 id="why-estimate-period-returns-only-one-period">Why estimate.period() Returns Only One Period<a class="anchor" aria-label="anchor" href="#why-estimate-period-returns-only-one-period"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Signal with two independent periods</span></span>
<span><span class="va">period1</span> <span class="op">&lt;-</span> <span class="fl">2</span>   <span class="co"># Fast cycle</span></span>
<span><span class="va">period2</span> <span class="op">&lt;-</span> <span class="fl">7</span>   <span class="co"># Slow cycle</span></span>
<span></span>
<span><span class="va">X_dual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period2</span><span class="op">)</span></span>
<span><span class="va">fd_dual</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_dual</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X_dual</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Signal with Two Periods (2 and 7)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/dual-period-signal-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_dual</span>, method <span class="op">=</span> <span class="st">"fft"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Single estimate:"</span>, <span class="va">est_single</span><span class="op">$</span><span class="va">period</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Single estimate: 2.005013</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"(Only detects the dominant period)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Only detects the dominant period)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-detect-periods">Using detect.periods()<a class="anchor" aria-label="anchor" href="#using-detect-periods"></a>
</h3>
<p>The <code><a href="../reference/detect.periods.html">detect.periods()</a></code> function uses an iterative residual
approach implemented in Rust for efficiency:</p>
<ol style="list-style-type: decimal">
<li>Estimate the dominant period using FFT</li>
<li>Subtract a fitted sinusoid at that period</li>
<li>Repeat on the residual until confidence or strength drops too
low</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detect multiple periods using the package function</span></span>
<span><span class="co"># Higher thresholds prevent spurious detection</span></span>
<span><span class="va">detected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.periods.html">detect.periods</a></span><span class="op">(</span><span class="va">fd_dual</span>, max_periods <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                     min_confidence <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                     min_strength <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">detected</span><span class="op">)</span></span>
<span><span class="co">#&gt; Multiple Period Detection</span></span>
<span><span class="co">#&gt; -------------------------</span></span>
<span><span class="co">#&gt; Periods detected: 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Period 1: 2.005 (confidence=148.091, strength=0.741, amplitude=0.956)</span></span>
<span><span class="co">#&gt; Period 2: 6.683 (confidence=123.084, strength=0.628, amplitude=0.444)</span></span>
<span><span class="co">#&gt; Period 3: 10.025 (confidence=128.631, strength=0.705, amplitude=0.282)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-the-decomposition">Visualizing the Decomposition<a class="anchor" aria-label="anchor" href="#visualizing-the-decomposition"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reconstruct each component using detected periods</span></span>
<span><span class="va">components</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span><span class="va">residual</span> <span class="op">&lt;-</span> <span class="va">X_dual</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">detected</span><span class="op">$</span><span class="va">n_periods</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">detected</span><span class="op">$</span><span class="va">n_periods</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">omega</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">/</span> <span class="va">detected</span><span class="op">$</span><span class="va">periods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">cos_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">omega</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span></span>
<span>    <span class="va">sin_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">omega</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">residual</span> <span class="op">*</span> <span class="va">cos_comp</span><span class="op">)</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">residual</span> <span class="op">*</span> <span class="va">sin_comp</span><span class="op">)</span></span>
<span>    <span class="va">component</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="va">cos_comp</span> <span class="op">+</span> <span class="va">b</span> <span class="op">*</span> <span class="va">sin_comp</span></span>
<span>    <span class="va">components</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Period_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">detected</span><span class="op">$</span><span class="va">periods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">component</span></span>
<span>    <span class="va">residual</span> <span class="op">&lt;-</span> <span class="va">residual</span> <span class="op">-</span> <span class="va">component</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">components</span><span class="op">$</span><span class="va">Residual</span> <span class="op">&lt;-</span> <span class="va">residual</span></span>
<span><span class="va">components</span><span class="op">$</span><span class="va">Original</span> <span class="op">&lt;-</span> <span class="va">X_dual</span></span>
<span></span>
<span><span class="co"># Plot decomposition</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="va">df_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">components</span>, <span class="op">-</span><span class="va">t</span>, names_to <span class="op">=</span> <span class="st">"Component"</span>, values_to <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span><span class="co"># Get period column names (exclude t, Residual, Original)</span></span>
<span><span class="va">period_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">components</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="st">"Residual"</span>, <span class="st">"Original"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_long</span><span class="op">$</span><span class="va">Component</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">df_long</span><span class="op">$</span><span class="va">Component</span>,</span>
<span>                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original"</span>, <span class="va">period_cols</span>, <span class="st">"Residual"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Component</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Decomposition into Periodic Components"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/period-decomposition-1.png" class="r-plt" alt="" width="100%"></p>
<p><strong>Practical guidance:</strong></p>
<ul>
<li>For <strong>harmonics of the same fundamental</strong>:
<code><a href="../reference/estimate.period.html">estimate.period()</a></code> correctly finds the fundamental period.
No iterative approach needed.</li>
<li>For <strong>truly different periods</strong> (e.g., daily + yearly):
use the iterative approach above.</li>
<li>When <strong>confidence drops below threshold</strong>: stop -
remaining signal is likely noise.</li>
</ul>
<p><strong>Note on detection order:</strong> Periods are detected in
order of <strong>amplitude</strong>, not period length. The component
with the highest FFT power (roughly proportional to amplitude squared)
is found first. For example, if a signal has a weak yearly cycle and a
strong weekly cycle, the weekly cycle will be detected first regardless
of which period is longer. Very weak periodicities (&lt; 20% of the
dominant amplitude) may require lower thresholds but risk false
positives.</p>
</div>
</div>
<div class="section level2">
<h2 id="handling-non-stationary-data">Handling Non-Stationary Data<a class="anchor" aria-label="anchor" href="#handling-non-stationary-data"></a>
</h2>
<p>Real-world time series often have trends that can mask or distort
seasonal patterns. fdars provides comprehensive detrending and
decomposition functions to handle this.</p>
<div class="section level3">
<h3 id="the-problem-trends-mask-seasonality">The Problem: Trends Mask Seasonality<a class="anchor" aria-label="anchor" href="#the-problem-trends-mask-seasonality"></a>
</h3>
<p>When a strong trend is present, seasonal analysis functions may
fail:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Signal with strong linear trend + seasonality + noise</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">X_trend</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">t</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">fd_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_trend</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X_trend</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Seasonal Signal with Strong Linear Trend"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"The trend dominates, masking the seasonality"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/trend-problem-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Without detrending - incorrect results!</span></span>
<span><span class="va">period_wrong</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_trend</span><span class="op">)</span><span class="op">$</span><span class="va">period</span></span>
<span><span class="va">strength_wrong</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_trend</span>, period <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"WITHOUT detrending:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; WITHOUT detrending:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Estimated period:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">period_wrong</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"(true: 2.5)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Estimated period: 20.05 (true: 2.5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Seasonal strength:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">strength_wrong</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"(should be ~1)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Seasonal strength: 0.005 (should be ~1)</span></span></code></pre></div>
<p>The trend causes: - Period estimation to return the series length
(20) instead of the true period (2.5) - Seasonal strength to be nearly
zero, when it should be close to 1</p>
</div>
<div class="section level3">
<h3 id="using-detrend">Using detrend()<a class="anchor" aria-label="anchor" href="#using-detrend"></a>
</h3>
<p>The <code><a href="../reference/detrend.html">detrend()</a></code> function removes trends using various
methods:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Linear detrending</span></span>
<span><span class="va">fd_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detrend.html">detrend</a></span><span class="op">(</span><span class="va">fd_trend</span>, method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Polynomial detrending (degree 2)</span></span>
<span><span class="va">fd_poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detrend.html">detrend</a></span><span class="op">(</span><span class="va">fd_trend</span>, method <span class="op">=</span> <span class="st">"polynomial"</span>, degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># LOESS detrending (flexible, non-parametric)</span></span>
<span><span class="va">fd_loess</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detrend.html">detrend</a></span><span class="op">(</span><span class="va">fd_trend</span>, method <span class="op">=</span> <span class="st">"loess"</span>, bandwidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Automatic selection via AIC</span></span>
<span><span class="va">fd_auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detrend.html">detrend</a></span><span class="op">(</span><span class="va">fd_trend</span>, method <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"After detrending, estimated periods:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; After detrending, estimated periods:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Linear:     "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_linear</span><span class="op">)</span><span class="op">$</span><span class="va">period</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Linear:      2.506</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Polynomial: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_poly</span><span class="op">)</span><span class="op">$</span><span class="va">period</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Polynomial:  2.506</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  LOESS:      "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_loess</span><span class="op">)</span><span class="op">$</span><span class="va">period</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   LOESS:       2.506</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Auto:       "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_auto</span><span class="op">)</span><span class="op">$</span><span class="va">period</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"(true: 2.5)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Auto:        2.506 (true: 2.5)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getting-both-trend-and-detrended-data">Getting Both Trend and Detrended Data<a class="anchor" aria-label="anchor" href="#getting-both-trend-and-detrended-data"></a>
</h3>
<p>Use <code>return_trend = TRUE</code> to get both components:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detrend.html">detrend</a></span><span class="op">(</span><span class="va">fd_trend</span>, method <span class="op">=</span> <span class="st">"linear"</span>, return_trend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot original, trend, and detrended</span></span>
<span><span class="va">df_decomp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">t</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fd_trend</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">result</span><span class="op">$</span><span class="va">trend</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">result</span><span class="op">$</span><span class="va">detrended</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  Component <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original"</span>, <span class="st">"Trend"</span>, <span class="st">"Detrended"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original"</span>, <span class="st">"Trend"</span>, <span class="st">"Detrended"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_decomp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Component</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Linear Detrending Result"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/detrend-return-trend-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="seasonal-trend-decomposition">Seasonal-Trend Decomposition<a class="anchor" aria-label="anchor" href="#seasonal-trend-decomposition"></a>
</h3>
<p>For full decomposition into trend, seasonal, and remainder
components, use <code><a href="../reference/decompose.html">decompose()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Additive decomposition: data = trend + seasonal + remainder</span></span>
<span><span class="va">decomp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose.html">decompose</a></span><span class="op">(</span><span class="va">fd_trend</span>, period <span class="op">=</span> <span class="fl">2.5</span>, method <span class="op">=</span> <span class="st">"additive"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot all components</span></span>
<span><span class="va">df_stl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">t</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fd_trend</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">decomp</span><span class="op">$</span><span class="va">trend</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>,</span>
<span>        <span class="va">decomp</span><span class="op">$</span><span class="va">seasonal</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">decomp</span><span class="op">$</span><span class="va">remainder</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  Component <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original"</span>, <span class="st">"Trend"</span>, <span class="st">"Seasonal"</span>, <span class="st">"Remainder"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original"</span>, <span class="st">"Trend"</span>, <span class="st">"Seasonal"</span>, <span class="st">"Remainder"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_stl</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Component</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Additive Seasonal-Trend Decomposition"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/decompose-additive-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="multiplicative-seasonality">Multiplicative Seasonality<a class="anchor" aria-label="anchor" href="#multiplicative-seasonality"></a>
</h3>
<p>When the seasonal amplitude grows with the trend level, use
multiplicative decomposition:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Multiplicative pattern: amplitude grows with level + noise</span></span>
<span><span class="va">X_mult</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">fd_mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_mult</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot - note how peaks get taller over time</span></span>
<span><span class="va">df_mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X_mult</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_mult</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Multiplicative Seasonality"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Seasonal amplitude grows with trend level"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/decompose-multiplicative-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Multiplicative decomposition</span></span>
<span><span class="va">decomp_mult</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose.html">decompose</a></span><span class="op">(</span><span class="va">fd_mult</span>, period <span class="op">=</span> <span class="fl">2.5</span>, method <span class="op">=</span> <span class="st">"multiplicative"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Multiplicative decomposition:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Multiplicative decomposition:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Seasonal range:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">decomp_mult</span><span class="op">$</span><span class="va">seasonal</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Seasonal range: 0.631 1.469</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  (Values near 1 indicate multiplicative factors)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   (Values near 1 indicate multiplicative factors)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="integrated-detrending-in-other-functions">Integrated Detrending in Other Functions<a class="anchor" aria-label="anchor" href="#integrated-detrending-in-other-functions"></a>
</h3>
<p>All main seasonal functions support a <code>detrend_method</code>
parameter:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># These are equivalent:</span></span>
<span><span class="co"># 1. Explicit detrending</span></span>
<span><span class="va">fd_det</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detrend.html">detrend</a></span><span class="op">(</span><span class="va">fd_trend</span>, method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_det</span><span class="op">)</span><span class="op">$</span><span class="va">period</span></span>
<span></span>
<span><span class="co"># 2. Integrated detrending parameter</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_trend</span>, detrend_method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span><span class="op">$</span><span class="va">period</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Explicit detrend:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">p1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Explicit detrend: 2.506</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Integrated param:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">p2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Integrated param: 2.506</span></span></code></pre></div>
<p>The <code>detrend_method</code> parameter is available in: -
<code><a href="../reference/estimate.period.html">estimate.period()</a></code> - For accurate period estimation on
trending data - <code><a href="../reference/detect.peaks.html">detect.peaks()</a></code> - For correct peak
prominence calculation - <code><a href="../reference/seasonal.strength.html">seasonal.strength()</a></code> - For true
seasonality measurement - <code><a href="../reference/detect.periods.html">detect.periods()</a></code> - Uses “auto” by
default</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dramatic improvement with detrending</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nSeasonal strength comparison:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Seasonal strength comparison:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Without detrend:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_trend</span>, period <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Without detrend: 0.005</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  With detrend:   "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_trend</span>, period <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>                                                   detrend_method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   With detrend:    0.834</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="peak-detection-with-detrending">Peak Detection with Detrending<a class="anchor" aria-label="anchor" href="#peak-detection-with-detrending"></a>
</h3>
<p>Trends also affect peak detection - the upward slope can distort
prominence calculations and make later peaks appear more prominent than
earlier ones.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detect peaks without detrending</span></span>
<span><span class="va">peaks_no_detrend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_trend</span>, min_distance <span class="op">=</span> <span class="fl">2</span>, smooth_first <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Detect peaks with detrending</span></span>
<span><span class="va">peaks_with_detrend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_trend</span>, min_distance <span class="op">=</span> <span class="fl">2</span>, smooth_first <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    detrend_method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Peak detection on trending data:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Peak detection on trending data:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Without detrend:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_no_detrend</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"peaks,"</span>,</span>
<span>    <span class="st">"mean period:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">peaks_no_detrend</span><span class="op">$</span><span class="va">mean_period</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Without detrend: 5 peaks, mean period: 4.398</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  With detrend:   "</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_with_detrend</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"peaks,"</span>,</span>
<span>    <span class="st">"mean period:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">peaks_with_detrend</span><span class="op">$</span><span class="va">mean_period</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"(true: 2.5)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   With detrend:    8 peaks, mean period: 2.506 (true: 2.5)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize the difference</span></span>
<span><span class="va">peaks_raw</span> <span class="op">&lt;-</span> <span class="va">peaks_no_detrend</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">peaks_det</span> <span class="op">&lt;-</span> <span class="va">peaks_with_detrend</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Get detrended data for plotting</span></span>
<span><span class="va">fd_detrended</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detrend.html">detrend</a></span><span class="op">(</span><span class="va">fd_trend</span>, method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_peaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">t</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fd_trend</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">fd_detrended</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,</span>
<span>  Panel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (with trend)"</span>, <span class="st">"Detrended"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (with trend)"</span>, <span class="st">"Detrended"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine peak data</span></span>
<span><span class="va">peaks_raw</span><span class="op">$</span><span class="va">Panel</span> <span class="op">&lt;-</span> <span class="st">"Original (with trend)"</span></span>
<span><span class="va">peaks_det</span><span class="op">$</span><span class="va">Panel</span> <span class="op">&lt;-</span> <span class="st">"Detrended"</span></span>
<span><span class="co"># Adjust detrended peak values to match detrended data</span></span>
<span><span class="va">peaks_det</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="va">fd_detrended</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">peaks_det</span><span class="op">$</span><span class="va">time</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">peaks_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">peaks_raw</span>, <span class="va">peaks_det</span><span class="op">)</span></span>
<span><span class="va">peaks_combined</span><span class="op">$</span><span class="va">Panel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">peaks_combined</span><span class="op">$</span><span class="va">Panel</span>,</span>
<span>                                levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (with trend)"</span>, <span class="st">"Detrended"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_peaks</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">peaks_combined</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Panel</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Peak Detection: With vs Without Detrending"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Detrending ensures consistent peak detection across the series"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/peaks-trending-plot-1.png" class="r-plt" alt="" width="100%"></p>
<p>Detrending is especially important when: - Peaks near the start/end
of the series have different prominence due to the trend - You need
consistent peak-to-peak period estimates - The trend slope is comparable
to or larger than the seasonal amplitude</p>
</div>
<div class="section level3">
<h3 id="choosing-a-detrending-method">Choosing a Detrending Method<a class="anchor" aria-label="anchor" href="#choosing-a-detrending-method"></a>
</h3>
<table class="table">
<colgroup>
<col width="26%">
<col width="33%">
<col width="40%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Use When</th>
<th>Parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"linear"</code></td>
<td>Simple linear trends</td>
<td>None</td>
</tr>
<tr class="even">
<td><code>"polynomial"</code></td>
<td>Curved trends (quadratic, cubic)</td>
<td>
<code>degree</code> (2, 3, etc.)</td>
</tr>
<tr class="odd">
<td><code>"loess"</code></td>
<td>Complex, irregular trends</td>
<td>
<code>bandwidth</code> (0.1-0.5)</td>
</tr>
<tr class="even">
<td><code>"diff1"</code></td>
<td>Random walk-like data</td>
<td>None (reduces length by 1)</td>
</tr>
<tr class="odd">
<td><code>"diff2"</code></td>
<td>Integrated processes</td>
<td>None (reduces length by 2)</td>
</tr>
<tr class="even">
<td><code>"auto"</code></td>
<td>Unknown trend type</td>
<td>Selects via AIC</td>
</tr>
</tbody>
</table>
<p><strong>Recommendation:</strong> Start with <code>"linear"</code> for
most cases. Use <code>"auto"</code> if unsure. Use <code>"loess"</code>
for complex trends that polynomial methods cannot capture.</p>
</div>
</div>
<div class="section level2">
<h2 id="peak-detection">Peak Detection<a class="anchor" aria-label="anchor" href="#peak-detection"></a>
</h2>
<p>Peak detection identifies local maxima in seasonal signals. This is
useful for characterizing seasonal patterns and estimating period from
peak-to-peak distances.</p>
<div class="section level3">
<h3 id="parameter-tuning-guide">Parameter Tuning Guide<a class="anchor" aria-label="anchor" href="#parameter-tuning-guide"></a>
</h3>
<p>Peak detection quality depends heavily on parameters. Here’s a
reference:</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="17%">
<col width="30%">
<col width="30%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Purpose</th>
<th>Typical Values</th>
<th>When to Adjust</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>min_distance</code></td>
<td>Minimum time between peaks</td>
<td><code>period * 0.8</code></td>
<td>Set to ~80% of expected period</td>
</tr>
<tr class="even">
<td><code>min_prominence</code></td>
<td>How much peak stands out</td>
<td>0.1-0.5 x amplitude</td>
<td>Increase if too many noise peaks</td>
</tr>
<tr class="odd">
<td><code>smooth_first</code></td>
<td>Pre-smooth noisy data</td>
<td>
<code>TRUE</code> for real data</td>
<td>Almost always use <code>TRUE</code>
</td>
</tr>
<tr class="even">
<td><code>smooth_nbasis</code></td>
<td>Number of Fourier basis</td>
<td>
<code>NULL</code> (auto CV)</td>
<td>Let CV choose optimal nbasis</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="effect-of-parameters">Effect of Parameters<a class="anchor" aria-label="anchor" href="#effect-of-parameters"></a>
</h3>
<p>Let’s demonstrate how parameters affect detection quality.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Moderately noisy signal</span></span>
<span><span class="va">X_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">fd_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_demo</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X_demo</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-the-smoothing-step">Visualizing the Smoothing Step<a class="anchor" aria-label="anchor" href="#visualizing-the-smoothing-step"></a>
</h3>
<p>Before detecting peaks, let’s see what Fourier basis smoothing does
to noisy data:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply Fourier basis smoothing with CV-selected optimal nbasis</span></span>
<span><span class="va">cv_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata2basis_cv.html">fdata2basis_cv</a></span><span class="op">(</span><span class="va">fd_demo</span>, nbasis.range <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">25</span>, type <span class="op">=</span> <span class="st">"fourier"</span>, criterion <span class="op">=</span> <span class="st">"GCV"</span><span class="op">)</span></span>
<span><span class="va">fd_smoothed</span> <span class="op">&lt;-</span> <span class="va">cv_result</span><span class="op">$</span><span class="va">fitted</span></span>
<span></span>
<span><span class="co"># Compare original vs smoothed</span></span>
<span><span class="va">df_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">t</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">X_demo</span>, <span class="va">fd_smoothed</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (noisy)"</span>, <span class="st">"Smoothed (Fourier)"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_smooth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original (noisy)"</span> <span class="op">=</span> <span class="st">"gray50"</span>,</span>
<span>                                 <span class="st">"Smoothed (Fourier)"</span> <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Effect of Fourier Basis Smoothing on Noisy Signal"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CV-selected optimal nbasis ="</span>, <span class="va">cv_result</span><span class="op">$</span><span class="va">optimal.nbasis</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/smoothing-step-1.png" class="r-plt" alt="" width="100%"></p>
<p>Fourier basis smoothing is ideal for seasonal signals because it
naturally captures periodic patterns. Peak detection on the smoothed
data will find the true peaks, not noise spikes.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default parameters - often too many peaks</span></span>
<span><span class="va">peaks_default</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_demo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Default parameters:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_default</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"peaks found\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Default parameters: 96 peaks found</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"(Expected:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span>, <span class="st">"peaks)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Expected: 10 peaks)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add minimum distance constraint</span></span>
<span><span class="va">peaks_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_demo</span>, min_distance <span class="op">=</span> <span class="va">period_true</span> <span class="op">*</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"With min_distance:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_distance</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"peaks found\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; With min_distance: 12 peaks found</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add Fourier smoothing for best results (GCV auto-selects nbasis)</span></span>
<span><span class="va">peaks_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_demo</span>, min_distance <span class="op">=</span> <span class="va">period_true</span> <span class="op">*</span> <span class="fl">0.8</span>,</span>
<span>                             smooth_first <span class="op">=</span> <span class="cn">TRUE</span>, smooth_nbasis <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"With smoothing:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_smooth</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"peaks found\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; With smoothing: 10 peaks found</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Estimated period from peaks:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">peaks_smooth</span><span class="op">$</span><span class="va">mean_period</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated period from peaks: 1.999</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-the-difference">Visualizing the Difference<a class="anchor" aria-label="anchor" href="#visualizing-the-difference"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare data for plotting</span></span>
<span><span class="va">df_default</span> <span class="op">&lt;-</span> <span class="va">peaks_default</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">df_distance</span> <span class="op">&lt;-</span> <span class="va">peaks_distance</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">df_smooth</span> <span class="op">&lt;-</span> <span class="va">peaks_smooth</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create combined plot</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray50"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_default</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Default:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_default</span><span class="op">)</span>, <span class="st">"peaks"</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray50"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_distance</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"With min_distance:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_distance</span><span class="op">)</span>, <span class="st">"peaks"</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray50"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_smooth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"With smoothing:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_smooth</span><span class="op">)</span>, <span class="st">"peaks"</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/peak-comparison-plot-1.png" class="r-plt" alt="" width="100%"></p>
<p><strong>Why peak detection in noisy signals is challenging:</strong>
Noise creates many local maxima that are not true peaks. Without
smoothing, peak detection algorithms struggle to distinguish genuine
seasonal peaks from random fluctuations. The <code>min_distance</code>
parameter helps, but cannot fully solve the problem when noise amplitude
is comparable to the signal.</p>
<p><strong>Key insight:</strong> For seasonal data, use Fourier basis
smoothing with <code>smooth_first = TRUE</code>. The Fourier basis is
ideal for periodic signals because it naturally captures oscillatory
patterns while suppressing noise. GCV automatically selects the optimal
number of basis functions, balancing smoothness and fidelity to the
data.</p>
</div>
<div class="section level3">
<h3 id="prominence-filtering">Prominence Filtering<a class="anchor" aria-label="anchor" href="#prominence-filtering"></a>
</h3>
<p>Prominence measures how much a peak stands out from surrounding
values. Use it to filter minor peaks. For best results with noisy data,
combine prominence filtering with smoothing.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare prominence thresholds without smoothing (less reliable)</span></span>
<span><span class="va">peaks_low_prom_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_demo</span>, min_distance <span class="op">=</span> <span class="fl">1.5</span>, min_prominence <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">peaks_high_prom_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_demo</span>, min_distance <span class="op">=</span> <span class="fl">1.5</span>, min_prominence <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Without smoothing:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Without smoothing:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Low prominence (0.1):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_low_prom_raw</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"peaks\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Low prominence (0.1): 7 peaks</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  High prominence (0.5):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_high_prom_raw</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"peaks\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   High prominence (0.5): 1 peaks</span></span>
<span></span>
<span><span class="co"># With smoothing - more reliable results</span></span>
<span><span class="va">peaks_low_prom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_demo</span>, min_distance <span class="op">=</span> <span class="fl">1.5</span>, min_prominence <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                                smooth_first <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">peaks_high_prom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_demo</span>, min_distance <span class="op">=</span> <span class="fl">1.5</span>, min_prominence <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                 smooth_first <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nWith smoothing:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; With smoothing:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Low prominence (0.1):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_low_prom</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"peaks\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Low prominence (0.1): 4 peaks</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  High prominence (0.5):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_high_prom</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"peaks\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   High prominence (0.5): 4 peaks</span></span></code></pre></div>
<p>When smoothing is applied first, the prominence values become more
meaningful because they reflect actual signal characteristics rather
than noise artifacts.</p>
</div>
<div class="section level3">
<h3 id="different-signal-amplitudes">Different Signal Amplitudes<a class="anchor" aria-label="anchor" href="#different-signal-amplitudes"></a>
</h3>
<p>Peak detection works correctly regardless of signal amplitude. The
algorithm normalizes internally based on local signal
characteristics.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">amplitudes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">5.0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create plots for each amplitude</span></span>
<span><span class="va">amplitude_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">amplitudes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">amp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">amp</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="va">X</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span></span>
<span>  <span class="va">peaks</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">peaks</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Amplitude ="</span>, <span class="va">amp</span>, <span class="st">"- Found"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks</span><span class="op">)</span>, <span class="st">"peaks"</span><span class="op">)</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">amplitude_plots</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/amplitude-examples-1.png" class="r-plt" alt="" width="100%"></p>
<p>All four signals correctly detect 5 peaks, with peak values matching
their respective amplitudes.</p>
</div>
<div class="section level3">
<h3 id="non-uniform-peak-spacing">Non-Uniform Peak Spacing<a class="anchor" aria-label="anchor" href="#non-uniform-peak-spacing"></a>
</h3>
<p>Real-world signals often have varying frequencies or complex
interference patterns. <code>detect.peaks</code> handles these cases by
analyzing local signal structure.</p>
<div class="section level4">
<h4 id="chirp-signal-increasing-frequency">Chirp Signal (Increasing Frequency)<a class="anchor" aria-label="anchor" href="#chirp-signal-increasing-frequency"></a>
</h4>
<p>A chirp signal has frequency that increases over time, causing peaks
to get progressively closer together.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="co"># Phase integral for linearly increasing frequency: phi(t) = 2*pi*(0.5*t + 0.05*t^2)</span></span>
<span><span class="va">phase</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0.5</span> <span class="op">*</span> <span class="va">t</span> <span class="op">+</span> <span class="fl">0.05</span> <span class="op">*</span> <span class="va">t</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">phase</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="va">X</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span></span>
<span><span class="va">peaks</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">peaks</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Chirp Signal: Frequency Increases Over Time"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Detected"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks</span><span class="op">)</span>, <span class="st">"peaks with decreasing spacing"</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/chirp-example-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show inter-peak distances decreasing over time</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">inter_peak_distances</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    peak_pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span>,</span>
<span>    distance <span class="op">=</span> <span class="va">distances</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_dist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">peak_pair</span>, y <span class="op">=</span> <span class="va">distance</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Inter-Peak Distances Decrease Over Time"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Peak Pair (sequential)"</span>, y <span class="op">=</span> <span class="st">"Distance"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/chirp-distances-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level4">
<h4 id="sum-of-sine-waves-interference-pattern">Sum of Sine Waves (Interference Pattern)<a class="anchor" aria-label="anchor" href="#sum-of-sine-waves-interference-pattern"></a>
</h4>
<p>When two sine waves with different periods are combined, they create
an interference pattern with non-uniform peak spacing.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, length.out <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="co"># Sum of periods 2 and 3</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="va">X</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd</span>, min_distance <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="va">peaks</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">peaks</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sum of Two Sine Waves (periods 2 and 3)"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Detected"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks</span><span class="op">)</span>, <span class="st">"peaks with varying spacing"</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/sum-sines-example-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show variable inter-peak distances</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">inter_peak_distances</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Inter-peak distances:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">distances</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inter-peak distances: 2.01 1.85 2.17 2.01 1.81</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Range:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"to"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Range: 1.81 to 2.17</span></span></code></pre></div>
<p>The peak detection algorithm correctly identifies local maxima even
when the underlying signal has complex structure with varying
peak-to-peak distances.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="measuring-seasonal-strength">Measuring Seasonal Strength<a class="anchor" aria-label="anchor" href="#measuring-seasonal-strength"></a>
</h2>
<p>Seasonal strength quantifies how much of the signal’s variance is
explained by the seasonal component. Values range from 0 (no
seasonality) to 1 (pure seasonal signal).</p>
<div class="section level3">
<h3 id="variance-vs-spectral-methods">Variance vs Spectral Methods<a class="anchor" aria-label="anchor" href="#variance-vs-spectral-methods"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ss_variance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_noisy</span>, period <span class="op">=</span> <span class="va">period_true</span>, method <span class="op">=</span> <span class="st">"variance"</span><span class="op">)</span></span>
<span><span class="va">ss_spectral</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_noisy</span>, period <span class="op">=</span> <span class="va">period_true</span>, method <span class="op">=</span> <span class="st">"spectral"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Variance method:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ss_variance</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Variance method: 0.863</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Spectral method:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ss_spectral</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spectral method: 0.893</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparing-different-signal-types">Comparing Different Signal Types<a class="anchor" aria-label="anchor" href="#comparing-different-signal-types"></a>
</h3>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create signals with different seasonality levels</span></span>
<span><span class="va">X_noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Pure noise</span></span>
<span><span class="va">fd_noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_noise</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_mixed</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fd_mixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_mixed</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate strengths</span></span>
<span><span class="va">strengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Pure seasonal"</span> <span class="op">=</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_pure</span>, period <span class="op">=</span> <span class="va">period_true</span><span class="op">)</span>,</span>
<span>  <span class="st">"Noisy seasonal (0.3 SD)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_noisy</span>, period <span class="op">=</span> <span class="va">period_true</span><span class="op">)</span>,</span>
<span>  <span class="st">"Mixed (50/50)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_mixed</span>, period <span class="op">=</span> <span class="va">period_true</span><span class="op">)</span>,</span>
<span>  <span class="st">"Pure noise"</span> <span class="op">=</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_noise</span>, period <span class="op">=</span> <span class="va">period_true</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_strength</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Signal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">strengths</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">strengths</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Strength <span class="op">=</span> <span class="va">strengths</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_strength</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Signal</span>, y <span class="op">=</span> <span class="va">Strength</span>, fill <span class="op">=</span> <span class="va">Signal</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Seasonal Strength Comparison"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Seasonal Strength"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">15</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/strength-comparison-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="time-varying-seasonal-strength">Time-Varying Seasonal Strength<a class="anchor" aria-label="anchor" href="#time-varying-seasonal-strength"></a>
</h3>
<p>Seasonal strength can change over time. Use a sliding window to track
this.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Signal that loses seasonality</span></span>
<span><span class="va">t_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, length.out <span class="op">=</span> <span class="fl">800</span><span class="op">)</span></span>
<span><span class="va">X_changing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">t_long</span> <span class="op">&lt;</span> <span class="fl">20</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t_long</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">t_long</span> <span class="op">&lt;</span> <span class="fl">20</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">t_long</span> <span class="op">&gt;=</span> <span class="fl">20</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fd_changing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_changing</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t_long</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute time-varying strength</span></span>
<span><span class="va">ss_curve</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seasonal.strength.curve.html">seasonal.strength.curve</a></span><span class="op">(</span><span class="va">fd_changing</span>, period <span class="op">=</span> <span class="va">period_true</span>,</span>
<span>                                     window_size <span class="op">=</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">period_true</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot both signal and strength</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t_long</span>, y <span class="op">=</span> <span class="va">X_changing</span>, panel <span class="op">=</span> <span class="st">"Signal"</span><span class="op">)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t_long</span>, y <span class="op">=</span> <span class="va">ss_curve</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, panel <span class="op">=</span> <span class="st">"Seasonal Strength"</span><span class="op">)</span></span>
<span><span class="va">df_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_combined</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">panel</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">20</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Time-Varying Seasonal Strength"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Seasonality stops at t = 20 (red line)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/time-varying-strength-1.png" class="r-plt" alt="" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="change-detection">Change Detection<a class="anchor" aria-label="anchor" href="#change-detection"></a>
</h2>
<p>Automatically detect when seasonality starts or stops.</p>
<div class="section level3">
<h3 id="manual-threshold">Manual Threshold<a class="anchor" aria-label="anchor" href="#manual-threshold"></a>
</h3>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">changes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.seasonality.changes.html">detect.seasonality.changes</a></span><span class="op">(</span><span class="va">fd_changing</span>, period <span class="op">=</span> <span class="va">period_true</span>,</span>
<span>                                       threshold <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                                       window_size <span class="op">=</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">period_true</span>,</span>
<span>                                       min_duration <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">period_true</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">changes</span><span class="op">)</span></span>
<span><span class="co">#&gt; Seasonality Change Detection</span></span>
<span><span class="co">#&gt; ----------------------------</span></span>
<span><span class="co">#&gt; Number of changes: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       time      type strength_before strength_after</span></span>
<span><span class="co">#&gt; 1 20.47559 cessation       0.3152373      0.2918658</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="automatic-threshold-otsus-method">Automatic Threshold (Otsu’s Method)<a class="anchor" aria-label="anchor" href="#automatic-threshold-otsus-method"></a>
</h3>
<p>When you don’t know the appropriate threshold, use Otsu’s method to
determine it automatically from the data.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">changes_auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.seasonality.changes.auto.html">detect.seasonality.changes.auto</a></span><span class="op">(</span><span class="va">fd_changing</span>, period <span class="op">=</span> <span class="va">period_true</span>,</span>
<span>                                                 threshold_method <span class="op">=</span> <span class="st">"otsu"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">changes_auto</span><span class="op">)</span></span>
<span><span class="co">#&gt; Seasonality Change Detection (Auto Threshold)</span></span>
<span><span class="co">#&gt; ----------------------------------------------</span></span>
<span><span class="co">#&gt; Computed threshold: 0.5047</span></span>
<span><span class="co">#&gt; Number of changes: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;       time      type strength_before strength_after</span></span>
<span><span class="co">#&gt; 1 19.52441 cessation       0.5087545      0.5030707</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-change-points">Visualizing Change Points<a class="anchor" aria-label="anchor" href="#visualizing-change-points"></a>
</h3>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t_long</span>, y <span class="op">=</span> <span class="va">X_changing</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Seasonality Change Detection"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add change points</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">changes_auto</span><span class="op">$</span><span class="va">change_points</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">changes_auto</span><span class="op">$</span><span class="va">change_points</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cp</span> <span class="op">&lt;-</span> <span class="va">changes_auto</span><span class="op">$</span><span class="va">change_points</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">cp</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                        linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>                        color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">cp</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"onset"</span>, <span class="st">"green4"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>                        linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Green = onset, Red = cessation"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/change-plot-1.png" class="r-plt" alt="" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="signals-with-varying-period">Signals with Varying Period<a class="anchor" aria-label="anchor" href="#signals-with-varying-period"></a>
</h2>
<p>Some signals have periods that drift or change over time. The
<code><a href="../reference/instantaneous.period.html">instantaneous.period()</a></code> function uses the Hilbert transform
to estimate the period at each time point.</p>
<div class="section level3">
<h3 id="when-to-use-instantaneous-period">When to Use Instantaneous Period<a class="anchor" aria-label="anchor" href="#when-to-use-instantaneous-period"></a>
</h3>
<p><strong>Good use cases:</strong></p>
<ul>
<li>Slowly drifting systems (circadian rhythms shifting with
seasons)</li>
<li>Frequency-modulated (FM) signals in engineering</li>
<li>Climate oscillations with variable period (e.g., ENSO)</li>
</ul>
<p><strong>Poor use cases:</strong></p>
<ul>
<li>Random frequency jumps (use change detection instead)</li>
<li>Multiple concurrent periodicities (use iterative approach
instead)</li>
<li>Very noisy short series (use peak-to-peak methods instead)</li>
</ul>
</div>
<div class="section level3">
<h3 id="chirp-signal-smoothly-increasing-frequency">Chirp Signal (Smoothly Increasing Frequency)<a class="anchor" aria-label="anchor" href="#chirp-signal-smoothly-increasing-frequency"></a>
</h3>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Chirp: frequency increases linearly</span></span>
<span><span class="va">t_chirp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">freq</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.15</span> <span class="op">*</span> <span class="va">t_chirp</span>  <span class="co"># Frequency increases from 0.5 to 2</span></span>
<span><span class="va">phase</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">freq</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">t_chirp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X_chirp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">phase</span><span class="op">)</span></span>
<span><span class="va">fd_chirp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_chirp</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t_chirp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t_chirp</span>, y <span class="op">=</span> <span class="va">X_chirp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Chirp Signal (Smoothly Increasing Frequency)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/chirp-signal-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/instantaneous.period.html">instantaneous.period</a></span><span class="op">(</span><span class="va">fd_chirp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># True period (1/frequency)</span></span>
<span><span class="va">true_period</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">freq</span></span>
<span></span>
<span><span class="co"># Compare</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="va">t_chirp</span>,</span>
<span>  Estimated <span class="op">=</span> <span class="va">inst</span><span class="op">$</span><span class="va">period</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>,</span>
<span>  True <span class="op">=</span> <span class="va">true_period</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove extreme values at boundaries</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">Estimated</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Estimated</span> <span class="op">&gt;</span> <span class="fl">5</span> <span class="op">|</span> <span class="va">df</span><span class="op">$</span><span class="va">Estimated</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">True</span>, color <span class="op">=</span> <span class="st">"True"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Estimated</span>, color <span class="op">=</span> <span class="st">"Estimated"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True"</span> <span class="op">=</span> <span class="st">"steelblue"</span>, <span class="st">"Estimated"</span> <span class="op">=</span> <span class="st">"coral"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Instantaneous Period Estimation"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Period"</span>, color <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/chirp-estimate-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="amplitude-envelope-extraction">Amplitude Envelope Extraction<a class="anchor" aria-label="anchor" href="#amplitude-envelope-extraction"></a>
</h3>
<p>The Hilbert transform also provides the instantaneous amplitude
(envelope), useful for amplitude-modulated signals.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Amplitude-modulated signal</span></span>
<span><span class="va">envelope_true</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span>  <span class="co"># Slow modulation</span></span>
<span><span class="va">X_am</span> <span class="op">&lt;-</span> <span class="va">envelope_true</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">period_true</span><span class="op">)</span></span>
<span><span class="va">fd_am</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_am</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inst_am</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/instantaneous.period.html">instantaneous.period</a></span><span class="op">(</span><span class="va">fd_am</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="va">t</span>,</span>
<span>  Signal <span class="op">=</span> <span class="va">X_am</span>,</span>
<span>  Envelope <span class="op">=</span> <span class="va">inst_am</span><span class="op">$</span><span class="va">amplitude</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Signal</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Envelope</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">-</span><span class="va">Envelope</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Amplitude Envelope Extraction"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Red lines show the extracted envelope"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/envelope-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="limitations-and-alternatives">Limitations and Alternatives<a class="anchor" aria-label="anchor" href="#limitations-and-alternatives"></a>
</h3>
<p><strong>Boundary effects:</strong> The Hilbert transform produces
unreliable estimates near the beginning and end of the series.</p>
<p><strong>Noise sensitivity:</strong> High-frequency noise can corrupt
period estimates. Consider smoothing first.</p>
<p><strong>Random frequency changes:</strong> When frequency changes
abruptly and randomly, the instantaneous period estimate becomes
unreliable.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Demonstrate limitation: signal with random frequency regime changes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">t_rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">freq_regime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>  <span class="co"># Abrupt changes</span></span>
<span><span class="va">X_rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">freq_regime</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">t_rand</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fd_rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_rand</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t_rand</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inst_rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/instantaneous.period.html">instantaneous.period</a></span><span class="op">(</span><span class="va">fd_rand</span><span class="op">)</span></span>
<span><span class="va">est_period</span> <span class="op">&lt;-</span> <span class="va">inst_rand</span><span class="op">$</span><span class="va">period</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">est_period</span><span class="op">[</span><span class="va">est_period</span> <span class="op">&gt;</span> <span class="fl">5</span> <span class="op">|</span> <span class="va">est_period</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="va">t_rand</span>,</span>
<span>  True <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">freq_regime</span>,</span>
<span>  Estimated <span class="op">=</span> <span class="va">est_period</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">True</span>, color <span class="op">=</span> <span class="st">"True"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Estimated</span>, color <span class="op">=</span> <span class="st">"Estimated"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True"</span> <span class="op">=</span> <span class="st">"steelblue"</span>, <span class="st">"Estimated"</span> <span class="op">=</span> <span class="st">"coral"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Limitation: Abrupt Frequency Changes"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Hilbert transform struggles with discontinuities"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Period"</span>, color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/random-freq-1.png" class="r-plt" alt="" width="100%"></p>
<p><strong>Alternative for abrupt changes:</strong> Use
<code><a href="../reference/detect.seasonality.changes.html">detect.seasonality.changes()</a></code> to find regime boundaries,
then analyze each segment separately.</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-short-series">Working with Short Series<a class="anchor" aria-label="anchor" href="#working-with-short-series"></a>
</h2>
<p>For short series with only 3-5 complete cycles, fdars provides
specialized functions for analyzing peak timing variability and
classifying seasonality.</p>
<div class="section level3">
<h3 id="challenges-with-few-cycles">Challenges with Few Cycles<a class="anchor" aria-label="anchor" href="#challenges-with-few-cycles"></a>
</h3>
<ul>
<li>Period estimation has limited frequency resolution</li>
<li>Statistical measures have high uncertainty</li>
<li>Peak-to-peak analysis becomes more important</li>
</ul>
</div>
<div class="section level3">
<h3 id="peak-timing-variability">Peak Timing Variability<a class="anchor" aria-label="anchor" href="#peak-timing-variability"></a>
</h3>
<p>Detect shifts in peak timing between cycles (e.g., a phenological
event shifting from March to April to May over several years).</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate 5 years where peak timing shifts</span></span>
<span><span class="va">t_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">period_short</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Peaks shift gradually later each year</span></span>
<span><span class="va">phase_shifts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.08</span>, <span class="fl">0.04</span><span class="op">)</span></span>
<span><span class="va">X_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="va">X_short</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="va">t_short</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">phase_shifts</span><span class="op">[</span><span class="va">year</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">period_short</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">X_short</span> <span class="op">&lt;-</span> <span class="va">X_short</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fd_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_short</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t_short</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the short series</span></span>
<span><span class="va">df_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t_short</span>, y <span class="op">=</span> <span class="va">X_short</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_short</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">5</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"5-Year Series with Variable Peak Timing"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/short-series-plot-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyze peak timing</span></span>
<span><span class="va">timing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze.peak.timing.html">analyze.peak.timing</a></span><span class="op">(</span><span class="va">fd_short</span>, period <span class="op">=</span> <span class="va">period_short</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">timing</span><span class="op">)</span></span>
<span><span class="co">#&gt; Peak Timing Variability Analysis</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt; Number of peaks: 5</span></span>
<span><span class="co">#&gt; Mean timing:     0.1924</span></span>
<span><span class="co">#&gt; Std timing:      0.0364</span></span>
<span><span class="co">#&gt; Range timing:    0.1062</span></span>
<span><span class="co">#&gt; Variability:     0.3640 (moderate)</span></span>
<span><span class="co">#&gt; Timing trend:    -0.0110</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-peak-timing">Visualizing Peak Timing<a class="anchor" aria-label="anchor" href="#visualizing-peak-timing"></a>
</h3>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get detected peaks with Fourier smoothing</span></span>
<span><span class="va">peaks_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_short</span>, min_distance <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>                            smooth_first <span class="op">=</span> <span class="cn">TRUE</span>, smooth_nbasis <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">peak_df</span> <span class="op">&lt;-</span> <span class="va">peaks_short</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot with peaks marked</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_short</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">peak_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">5</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"5-Year Series with Detected Peaks"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/peak-timing-plot-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot peak timing within each year</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peak_df</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">peak_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">peak_df</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span>  <span class="va">peak_phase</span> <span class="op">&lt;-</span> <span class="va">peak_df</span><span class="op">$</span><span class="va">time</span> <span class="op">-</span> <span class="va">peak_years</span></span>
<span></span>
<span>  <span class="va">df_timing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="va">peak_years</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    phase <span class="op">=</span> <span class="va">peak_phase</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_timing</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">phase</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span>, color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Peak Timing Variability Across Years"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Phase within Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/timing-variability-plot-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="seasonality-classification">Seasonality Classification<a class="anchor" aria-label="anchor" href="#seasonality-classification"></a>
</h3>
<p>Automatically classify the type of seasonality pattern.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify.seasonality.html">classify.seasonality</a></span><span class="op">(</span><span class="va">fd_short</span>, period <span class="op">=</span> <span class="va">period_short</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">class_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Seasonality Classification</span></span>
<span><span class="co">#&gt; --------------------------</span></span>
<span><span class="co">#&gt; Classification:   StableSeasonal</span></span>
<span><span class="co">#&gt; Is seasonal:      TRUE</span></span>
<span><span class="co">#&gt; Stable timing:    TRUE</span></span>
<span><span class="co">#&gt; Timing variability: 0.3640</span></span>
<span><span class="co">#&gt; Seasonal strength:  0.9351</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize classification metrics</span></span>
<span><span class="co"># Normalize timing variability to 0-1 scale (lower is better/more stable)</span></span>
<span><span class="va">stability_score</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">class_result</span><span class="op">$</span><span class="va">timing_variability</span> <span class="op">/</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">class_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Seasonal Strength"</span>, <span class="st">"Timing Stability"</span><span class="op">)</span>,</span>
<span>  Value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">class_result</span><span class="op">$</span><span class="va">seasonal_strength</span>, <span class="va">stability_score</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">class_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Metric</span>, y <span class="op">=</span> <span class="va">Value</span>, fill <span class="op">=</span> <span class="va">Metric</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Classification:"</span>, <span class="va">class_result</span><span class="op">$</span><span class="va">classification</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Score"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/classification-plot-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="classification-types">Classification Types<a class="anchor" aria-label="anchor" href="#classification-types"></a>
</h3>
<p>The <code><a href="../reference/classify.seasonality.html">classify.seasonality()</a></code> function returns one of four
classifications based on seasonal strength and timing variability:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="22%">
<col width="27%">
<col width="27%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th>Classification</th>
<th>Seasonal Strength</th>
<th>Timing Variability</th>
<th>Interpretation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>stable</strong></td>
<td>&gt; 0.7</td>
<td>&lt; 0.05</td>
<td>Consistent pattern across cycles</td>
</tr>
<tr class="even">
<td><strong>variable</strong></td>
<td>0.4 - 0.7</td>
<td>0.05 - 0.15</td>
<td>Clear seasonality but parameters change</td>
</tr>
<tr class="odd">
<td><strong>intermittent</strong></td>
<td>&lt; 0.4</td>
<td>any</td>
<td>Seasonality appears and disappears</td>
</tr>
<tr class="even">
<td><strong>none</strong></td>
<td>&lt; 0.2</td>
<td>any</td>
<td>No clear seasonal pattern</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Stable seasonality - clean signal with consistent timing</span></span>
<span><span class="va">X_stable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t_short</span> <span class="op">/</span> <span class="va">period_short</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">fd_stable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_stable</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t_short</span><span class="op">)</span></span>
<span><span class="va">class_stable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify.seasonality.html">classify.seasonality</a></span><span class="op">(</span><span class="va">fd_stable</span>, period <span class="op">=</span> <span class="va">period_short</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example: Variable seasonality - amplitude and timing drift</span></span>
<span><span class="va">phase_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">amp_var</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t_short</span> <span class="op">/</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">X_variable</span> <span class="op">&lt;-</span> <span class="va">amp_var</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="va">t_short</span> <span class="op">+</span> <span class="va">phase_var</span><span class="op">)</span> <span class="op">/</span> <span class="va">period_short</span><span class="op">)</span> <span class="op">+</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">fd_variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_variable</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t_short</span><span class="op">)</span></span>
<span><span class="va">class_variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify.seasonality.html">classify.seasonality</a></span><span class="op">(</span><span class="va">fd_variable</span>, period <span class="op">=</span> <span class="va">period_short</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example: Intermittent seasonality - pattern appears and disappears</span></span>
<span><span class="va">X_intermittent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">t_short</span> <span class="op">&lt;</span> <span class="fl">2</span> <span class="op">|</span> <span class="va">t_short</span> <span class="op">&gt;</span> <span class="fl">4</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t_short</span> <span class="op">/</span> <span class="va">period_short</span><span class="op">)</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">t_short</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">t_short</span> <span class="op">&lt;=</span> <span class="fl">4</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X_intermittent</span> <span class="op">&lt;-</span> <span class="va">X_intermittent</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span><span class="va">fd_intermittent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_intermittent</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t_short</span><span class="op">)</span></span>
<span><span class="va">class_intermittent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify.seasonality.html">classify.seasonality</a></span><span class="op">(</span><span class="va">fd_intermittent</span>, period <span class="op">=</span> <span class="va">period_short</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example: No seasonality - pure noise</span></span>
<span><span class="va">X_none</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fd_none</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_none</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t_short</span><span class="op">)</span></span>
<span><span class="va">class_none</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify.seasonality.html">classify.seasonality</a></span><span class="op">(</span><span class="va">fd_none</span>, period <span class="op">=</span> <span class="va">period_short</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Classification results:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classification results:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Stable signal:      "</span>, <span class="va">class_stable</span><span class="op">$</span><span class="va">classification</span>,</span>
<span>    <span class="st">"(strength:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">class_stable</span><span class="op">$</span><span class="va">seasonal_strength</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Stable signal:       StableSeasonal (strength: 0.99 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Variable signal:    "</span>, <span class="va">class_variable</span><span class="op">$</span><span class="va">classification</span>,</span>
<span>    <span class="st">"(strength:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">class_variable</span><span class="op">$</span><span class="va">seasonal_strength</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Variable signal:     VariableTiming (strength: 0.78 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Intermittent signal:"</span>, <span class="va">class_intermittent</span><span class="op">$</span><span class="va">classification</span>,</span>
<span>    <span class="st">"(strength:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">class_intermittent</span><span class="op">$</span><span class="va">seasonal_strength</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Intermittent signal: IntermittentSeasonal (strength: 0.49 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  No seasonality:     "</span>, <span class="va">class_none</span><span class="op">$</span><span class="va">classification</span>,</span>
<span>    <span class="st">"(strength:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">class_none</span><span class="op">$</span><span class="va">seasonal_strength</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   No seasonality:      NonSeasonal (strength: 0.01 )</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize all four classification types</span></span>
<span><span class="va">df_examples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">t_short</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">X_stable</span>, <span class="va">X_variable</span>, <span class="va">X_intermittent</span>, <span class="va">X_none</span><span class="op">)</span>,</span>
<span>  Type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Stable"</span>, <span class="st">"Variable"</span>, <span class="st">"Intermittent"</span>, <span class="st">"None"</span><span class="op">)</span>,</span>
<span>                    each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Stable"</span>, <span class="st">"Variable"</span>, <span class="st">"Intermittent"</span>, <span class="st">"None"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_examples</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Type</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Seasonality Classification Examples"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/classification-examples-plot-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="automatic-fourier-smoothing-for-short-series">Automatic Fourier Smoothing for Short Series<a class="anchor" aria-label="anchor" href="#automatic-fourier-smoothing-for-short-series"></a>
</h3>
<p>Peak detection with automatic smoothing is especially important for
noisy short series.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># More noisy short series</span></span>
<span><span class="va">X_noisy_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t_short</span> <span class="op">/</span> <span class="va">period_short</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_short</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">fd_noisy_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X_noisy_short</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, argvals <span class="op">=</span> <span class="va">t_short</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Auto-select smoothing via Fourier basis CV</span></span>
<span><span class="va">cv_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata2basis_cv.html">fdata2basis_cv</a></span><span class="op">(</span><span class="va">fd_noisy_short</span>, nbasis.range <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">15</span>, type <span class="op">=</span> <span class="st">"fourier"</span><span class="op">)</span></span>
<span><span class="va">peaks_auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">cv_short</span><span class="op">$</span><span class="va">fitted</span>, min_distance <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Peaks found with Fourier CV smoothing:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">peaks_auto</span><span class="op">$</span><span class="va">peaks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Peaks found with Fourier CV smoothing: 5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Expected peaks:"</span>, <span class="fl">5</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Expected peaks: 5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Estimated period:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">peaks_auto</span><span class="op">$</span><span class="va">mean_period</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated period: 0.997</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="multiple-curves">Multiple Curves<a class="anchor" aria-label="anchor" href="#multiple-curves"></a>
</h2>
<p>All functions work with multiple curves simultaneously.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_curves</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1.8</span>, <span class="fl">2.2</span>, length.out <span class="op">=</span> <span class="va">n_curves</span><span class="op">)</span>  <span class="co"># Slightly varying periods</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_curves</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_curves</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">X</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">t</span> <span class="op">/</span> <span class="va">periods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">fd_curves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdata.html">fdata</a></span><span class="op">(</span><span class="va">X</span>, argvals <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot all curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fd_curves</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Multiple Seasonal Curves"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="seasonal-analysis_files/figure-html/multiple-curves-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Period estimation uses the mean curve</span></span>
<span><span class="va">est_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd_curves</span>, method <span class="op">=</span> <span class="st">"fft"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Estimated period (from mean):"</span>, <span class="va">est_mean</span><span class="op">$</span><span class="va">period</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated period (from mean): 2.01005</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"True mean period:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">periods</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; True mean period: 2</span></span>
<span></span>
<span><span class="co"># Peak detection for each curve</span></span>
<span><span class="va">peaks_curves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.peaks.html">detect.peaks</a></span><span class="op">(</span><span class="va">fd_curves</span>, min_distance <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMean period from peaks:"</span>, <span class="va">peaks_curves</span><span class="op">$</span><span class="va">mean_period</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mean period from peaks: 1.730653</span></span>
<span></span>
<span><span class="co"># Seasonal strength (aggregated)</span></span>
<span><span class="va">ss_curves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd_curves</span>, period <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Seasonal strength:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ss_curves</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Seasonal strength: 0.557</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<div class="section level3">
<h3 id="function-reference">Function Reference<a class="anchor" aria-label="anchor" href="#function-reference"></a>
</h3>
<table class="table">
<colgroup>
<col width="52%">
<col width="47%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/estimate.period.html">estimate.period()</a></code></td>
<td>Estimate seasonal period (FFT or ACF method)</td>
</tr>
<tr class="even">
<td><code><a href="../reference/detect.periods.html">detect.periods()</a></code></td>
<td>Detect multiple concurrent periodicities</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/detect.peaks.html">detect.peaks()</a></code></td>
<td>Find and characterize peaks (with auto GCV smoothing)</td>
</tr>
<tr class="even">
<td><code><a href="../reference/seasonal.strength.html">seasonal.strength()</a></code></td>
<td>Measure overall seasonality strength</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/seasonal.strength.curve.html">seasonal.strength.curve()</a></code></td>
<td>Time-varying seasonality strength</td>
</tr>
<tr class="even">
<td><code><a href="../reference/detect.seasonality.changes.html">detect.seasonality.changes()</a></code></td>
<td>Find onset/cessation of seasonality</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/detect.seasonality.changes.auto.html">detect.seasonality.changes.auto()</a></code></td>
<td>Auto threshold using Otsu’s method</td>
</tr>
<tr class="even">
<td><code><a href="../reference/instantaneous.period.html">instantaneous.period()</a></code></td>
<td>Period estimation for smoothly drifting signals</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/analyze.peak.timing.html">analyze.peak.timing()</a></code></td>
<td>Analyze peak timing variability across cycles</td>
</tr>
<tr class="even">
<td><code><a href="../reference/classify.seasonality.html">classify.seasonality()</a></code></td>
<td>Classify seasonality type (stable/variable/intermittent)</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/detrend.html">detrend()</a></code></td>
<td>Remove trends (linear, polynomial, LOESS, differencing)</td>
</tr>
<tr class="even">
<td><code><a href="../reference/decompose.html">decompose()</a></code></td>
<td>Seasonal-trend decomposition (additive or multiplicative)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="decision-guide">Decision Guide<a class="anchor" aria-label="anchor" href="#decision-guide"></a>
</h3>
<p><strong>Non-stationary data (trends present):</strong></p>
<ul>
<li>Linear trend: <code>detrend(method = "linear")</code> or use
<code>detrend_method = "linear"</code> parameter</li>
<li>Complex/curved trend: <code>detrend(method = "loess")</code> or
<code>method = "auto"</code>
</li>
<li>Growing seasonal amplitude:
<code>decompose(method = "multiplicative")</code>
</li>
<li>Full decomposition needed: <code><a href="../reference/decompose.html">decompose()</a></code> returns trend +
seasonal + remainder</li>
</ul>
<p><strong>Period estimation:</strong></p>
<ul>
<li>Period unknown, signal stable:
<code>estimate.period(method = "fft")</code>
</li>
<li>Period unknown, data has trend:
<code>estimate.period(detrend_method = "linear")</code>
</li>
<li>Period unknown, multiple independent periods:
<code><a href="../reference/detect.periods.html">detect.periods()</a></code>
</li>
<li>Period varies smoothly over time:
<code><a href="../reference/instantaneous.period.html">instantaneous.period()</a></code>
</li>
</ul>
<p><strong>Peak detection:</strong></p>
<ul>
<li>Clean data: <code><a href="../reference/detect.peaks.html">detect.peaks()</a></code> with default parameters</li>
<li>Noisy data: Add <code>smooth_first = TRUE</code> (Fourier smoothing
with GCV-selected nbasis)</li>
<li>Data with trend: Add <code>detrend_method = "linear"</code>
</li>
<li>Still too many peaks: Increase <code>min_prominence</code>
</li>
</ul>
<p><strong>Seasonal strength:</strong></p>
<ul>
<li>Single measurement: <code><a href="../reference/seasonal.strength.html">seasonal.strength()</a></code>
</li>
<li>Data with trend:
<code>seasonal.strength(detrend_method = "linear")</code>
</li>
<li>Track changes over time: <code><a href="../reference/seasonal.strength.curve.html">seasonal.strength.curve()</a></code>
</li>
<li>Detect when seasonality stops:
<code><a href="../reference/detect.seasonality.changes.auto.html">detect.seasonality.changes.auto()</a></code>
</li>
</ul>
<p><strong>Short series (3-5 cycles):</strong></p>
<ul>
<li>Characterize timing shifts: <code><a href="../reference/analyze.peak.timing.html">analyze.peak.timing()</a></code>
</li>
<li>Classify pattern type: <code><a href="../reference/classify.seasonality.html">classify.seasonality()</a></code>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="processing-large-numbers-of-series">Processing Large Numbers of Series<a class="anchor" aria-label="anchor" href="#processing-large-numbers-of-series"></a>
</h3>
<p>When analyzing many series (e.g., 500k time series), use a
<strong>tiered approach</strong> to balance speed and depth of
analysis:</p>
<p><strong>Tier 1 - Fast screening</strong> (all series):</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quick FFT period estimation - very fast</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"fft"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">confidence</span> <span class="op">&lt;</span> <span class="fl">0.3</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"no_seasonality"</span><span class="op">)</span></span></code></pre></div>
<p>This filters out ~80% of series with no clear seasonality in typical
mixed datasets.</p>
<p><strong>Tier 2 - Validation</strong> (remaining ~20%):</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add seasonal strength check</span></span>
<span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd</span>, period <span class="op">=</span> <span class="va">est</span><span class="op">$</span><span class="va">period</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">ss</span> <span class="op">&lt;</span> <span class="fl">0.2</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"weak_seasonality"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Tier 3 - Full analysis</strong> (top candidates only):</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Expensive operations - classification, multiple periods</span></span>
<span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify.seasonality.html">classify.seasonality</a></span><span class="op">(</span><span class="va">fd</span>, period <span class="op">=</span> <span class="va">est</span><span class="op">$</span><span class="va">period</span><span class="op">)</span></span>
<span><span class="va">periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/detect.periods.html">detect.periods</a></span><span class="op">(</span><span class="va">fd</span><span class="op">)</span>  <span class="co"># if multiple periods suspected</span></span></code></pre></div>
<p><strong>Parallelization:</strong></p>
<p>All fdars Rust functions are thread-safe. Use
<code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">parallel::mclapply()</a></code> or
<code>future.apply::future_lapply()</code> for parallel processing:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example batch processing workflow</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="va">series_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fd</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate.period.html">estimate.period</a></span><span class="op">(</span><span class="va">fd</span>, method <span class="op">=</span> <span class="st">"fft"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">confidence</span> <span class="op">&lt;</span> <span class="fl">0.3</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>classification <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seasonal.strength.html">seasonal.strength</a></span><span class="op">(</span><span class="va">fd</span>, period <span class="op">=</span> <span class="va">est</span><span class="op">$</span><span class="va">period</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>period <span class="op">=</span> <span class="va">est</span><span class="op">$</span><span class="va">period</span>, confidence <span class="op">=</span> <span class="va">est</span><span class="op">$</span><span class="va">confidence</span>, strength <span class="op">=</span> <span class="va">ss</span><span class="op">)</span></span>
<span><span class="op">}</span>, mc.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><strong>Memory management:</strong></p>
<ul>
<li>Process in batches of 1000-5000 series</li>
<li>Store only summary results (period, confidence, classification)</li>
<li>Stream data from disk rather than loading all at once</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Müller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
