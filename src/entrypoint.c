// Entrypoint for R to initialize the Rust extendr module

#include <R.h>
#include <Rinternals.h>

// Declaration of the extendr init function (generated by extendr)
void R_init_fdars_extendr(DllInfo *dll);

// R package init function
void R_init_fdars(DllInfo *dll) {
    R_init_fdars_extendr(dll);
}

// Wrappers to intercept abort/exit/_exit from Rust stdlib.
// The --wrap linker flag redirects: abort -> __wrap_abort, etc.
// These convert process termination into R errors, which is both
// CRAN-compliant and safer (prevents R from being killed).
// In practice these are unreachable: extendr catches Rust panics
// at the FFI boundary before they reach abort.
void __wrap_abort(void) { Rf_error("internal Rust error: abort"); }
void __wrap_exit(int status) { Rf_error("internal Rust error: exit(%d)", status); }
void __wrap__exit(int status) { Rf_error("internal Rust error: _exit(%d)", status); }
